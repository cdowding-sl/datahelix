{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http://scottlogic.com/datahelix.json",
  "title": "The Scott Logic DataHelix Profile Schema",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schemaVersion",
    "fields",
    "rules"
  ],
  "properties": {
    "additionalProperties": false,
    "schemaVersion": {
      "$ref": "#/definitions/schemaVersion"
    },
    "description": {
      "title": "A description of what data the profile is modelling",
      "type": "string"
    },
    "fields": {
      "title": "Defines the fields that data will be produced for. field names must begin with an alphabetic character.",
      "type": "array",
      "minItems": 1,
      "uniqueItems": true,
      "additionalItems": false,
      "items": {
        "$ref": "#/definitions/fieldDefinition"
      }
    },
    "rules": {
      "title": "The Rules defining the data to be output",
      "type": "array",
      "additionalItems": false,
      "items": {
        "title": "A set of Rule objects.",
        "type": "object",
        "additionalProperties": false,
        "required": [
          "constraints"
        ],
        "properties": {
          "rule": {
            "title": "A collection of constraints. Test case generation revolves around rules, in that the generator will output a separate dataset for each rule, wherein each row violates the rule in a different way.",
            "type": "string"
          },
          "constraints": {
            "type": "array",
            "items": {
              "$ref": "#/definitions/constraint"
            }
          }
        }
      }
    }
  },
  "definitions": {
    "schemaVersion": {
      "title": "The version of the DataHelix profile schema",
      "const": "0.10"
    },
    "dataType": {
      "oneOf": [
        {
          "$ref": "#/definitions/datetime"
        },
        {
          "$ref": "#/definitions/string"
        },
        {
          "$ref": "#/definitions/numeric"
        }
      ]
    },
    "datetime": {
      "title": "an ISO 8610 compatible string denoting a date and time",
      "type": "string",
      "additionalProperties": false,
      "default": "2000-01-01T09:00:00.000",
      "oneOf": [
        {
          "pattern": "^(?!0000)[0-9]{4}-([0][0-9]|[1][0-2])-([0-2][0-9]|3[01])T([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9][.][0-9]{3}Z?$"
        },
        {
          "enum": [
            "now"
          ]
        }
      ]
    },
    "numeric": {
      "type": "number",
      "minimum": -1e20,
      "maximum": 1e20,
      "default": 0
    },
    "integer": {
      "$ref": "#/definitions/numeric",
      "multipleOf": 1
    },
    "string": {
      "type": "string",
      "maxLength": 1000,
      "default": "string"
    },
    "fieldDefinition": {
      "title": "The field definitions of a field to generate data for",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "name"
      ],
      "default": {
        "name": "fieldName",
        "type": "string",
        "formatting": "",
        "unique": false,
        "nullable": true
      },
      "properties": {
        "name": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "decimal",
            "integer",
            "string",
            "datetime",
            "ISIN",
            "SEDOL",
            "CUSIP",
            "RIC",
            "firstname",
            "lastname",
            "fullname"
          ]
        },
        "formatting": {
          "type": "string"
        },
        "unique": {
          "type": "boolean"
        },
        "nullable": {
          "type": "boolean"
        }
      }
    },
    "constraint": {
      "oneOf": [
        {
          "$ref": "#/definitions/equalToConstraint"
        },
        {
          "$ref": "#/definitions/matchingRegexConstraint"
        },
        {
          "$ref": "#/definitions/containingRegexConstraint"
        },
        {
          "$ref": "#/definitions/ofLengthConstraint"
        },
        {
          "$ref": "#/definitions/longerThanConstraint"
        },
        {
          "$ref": "#/definitions/shorterThanConstraint"
        },
        {
          "$ref": "#/definitions/greaterThanConstraint"
        },
        {
          "$ref": "#/definitions/greaterThanOrEqualToConstraint"
        },
        {
          "$ref": "#/definitions/lessThanConstraint"
        },
        {
          "$ref": "#/definitions/lessThanOrEqualToConstraint"
        },
        {
          "$ref": "#/definitions/granularToConstraint"
        },
        {
          "$ref": "#/definitions/afterConstraint"
        },
        {
          "$ref": "#/definitions/afterOrAtConstraint"
        },
        {
          "$ref": "#/definitions/beforeConstraint"
        },
        {
          "$ref": "#/definitions/beforeOrAtConstraint"
        },
        {
          "$ref": "#/definitions/anyOfConstraint"
        },
        {
          "$ref": "#/definitions/allOfConstraint"
        },
        {
          "$ref": "#/definitions/nullConstraint"
        },
        {
          "$ref": "#/definitions/inSetConstraint"
        },
        {
          "$ref": "#/definitions/inMapConstraint"
        },
        {
          "$ref": "#/definitions/fromFileConstraint"
        },
        {
          "$ref": "#/definitions/notConstraint"
        },
        {
          "$ref": "#/definitions/conditionalConstraint"
        }
      ]
    },
    "equalToConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "equalTo"
      ],
      "properties": {
        "equalTo": {
          "anyOf": [
            {
              "type": "object",
              "required": [
                "field",
                "value"
              ],
              "additionalProperties": false,
              "properties": {
                "field": {
                  "type": "string"
                },
                "value": {
                  "oneOf": [
                    {
                      "$ref": "#/definitions/datetime"
                    },
                    {
                      "$ref": "#/definitions/numeric"
                    },
                    {
                      "$ref": "#/definitions/string"
                    }
                  ]
                }
              }
            },
            {
              "type": "object",
              "required": [
                "field",
                "otherField"
              ],
              "additionalProperties": true,
              "properties": {
                "field": {
                  "type": "string"
                },
                "otherField": {
                  "$ref": "#/definitions/string"
                },
                "offset": {
                  "$ref": "#/definitions/integer"
                },
                "offsetUnit": {
                  "type": "string"
                }
              }
            }
          ]
        }
      }
    },
    "matchingRegexConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "matchingRegex"
      ],
      "properties": {
        "matchingRegex": {
          "type": "object",
          "required": [
            "field",
            "value"
          ],
          "additionalProperties": false,
          "properties": {
            "field": {
              "type": "string"
            },
            "value": {
              "type": "string",
              "default": ".*"
            }
          }
        }
      }
    },
    "containingRegexConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "containingRegex"
      ],
      "properties": {
        "containingRegex": {
          "type": "object",
          "required": [
            "field",
            "value"
          ],
          "additionalProperties": false,
          "properties": {
            "field": {
              "type": "string"
            },
            "value": {
              "type": "string",
              "default": ".*"
            }
          }
        }
      }
    },
    "ofLengthConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "ofLength"
      ],
      "properties": {
        "ofLength": {
          "type": "object",
          "required": [
            "field",
            "value"
          ],
          "additionalProperties": false,
          "properties": {
            "field": {
              "type": "string"
            },
            "value": {
              "$ref": "#/definitions/integer",
              "minimum": 0,
              "maximum": 1000
            }
          }
        }
      }
    },
    "longerThanConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "longerThan"
      ],
      "properties": {
        "longerThan": {
          "type": "object",
          "required": [
            "field",
            "value"
          ],
          "additionalProperties": false,
          "properties": {
            "field": {
              "type": "string"
            },
            "value": {
              "$ref": "#/definitions/integer",
              "minimum": -1,
              "maximum": 999
            }
          }
        }
      }
    },
    "shorterThanConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "shorterThan"
      ],
      "properties": {
        "shorterThan": {
          "type": "object",
          "required": [
            "field",
            "value"
          ],
          "additionalProperties": false,
          "properties": {
            "field": {
              "type": "string"
            },
            "value": {
              "$ref": "#/definitions/integer",
              "minimum": 1,
              "maximum": 1001
            }
          }
        }
      }
    },
    "greaterThanConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "greaterThan"
      ],
      "properties": {
        "greaterThan": {
          "type": "object",
          "required": [
            "field",
            "value"
          ],
          "additionalProperties": false,
          "properties": {
            "field": {
              "type": "string"
            },
            "value": {
              "$ref": "#/definitions/numeric"
            }
          }
        }
      }
    },
    "greaterThanOrEqualToConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "greaterThanOrEqualTo"
      ],
      "properties": {
        "greaterThanOrEqualTo": {
          "type": "object",
          "required": [
            "field",
            "value"
          ],
          "additionalProperties": false,
          "properties": {
            "field": {
              "type": "string"
            },
            "value": {
              "$ref": "#/definitions/numeric"
            }
          }
        }
      }
    },
    "lessThanConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "lessThan"
      ],
      "properties": {
        "lessThan": {
          "type": "object",
          "required": [
            "field",
            "value"
          ],
          "additionalProperties": false,
          "properties": {
            "field": {
              "type": "string"
            },
            "value": {
              "$ref": "#/definitions/numeric"
            }
          }
        }
      }
    },
    "lessThanOrEqualToConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "lessThanOrEqualTo"
      ],
      "properties": {
        "lessThanOrEqualTo": {
          "type": "object",
          "required": [
            "field",
            "value"
          ],
          "additionalProperties": false,
          "properties": {
            "field": {
              "type": "string"
            },
            "value": {
              "$ref": "#/definitions/numeric"
            }
          }
        }
      }
    },
    "granularToConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "granularTo"
      ],
      "properties": {
        "granularTo": {
          "type": "object",
          "required": [
            "field",
            "value"
          ],
          "additionalProperties": false,
          "properties": {
            "field": {
              "type": "string"
            },
            "value": {
              "enum": [
                1,
                1e-1,
                1e-2,
                1e-3,
                1e-4,
                1e-5,
                1e-6,
                1e-7,
                1e-8,
                1e-9,
                1e-10,
                1e-11,
                1e-12,
                1e-13,
                1e-14,
                1e-15,
                1e-16,
                1e-17,
                1e-18,
                1e-19,
                1e-20,
                "millis",
                "seconds",
                "minutes",
                "hours",
                "days",
                "months",
                "years"
              ]
            }
          }
        }
      }
    },
    "afterConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "after"
      ],
      "properties": {
        "after": {
          "anyOf": [
            {
              "type": "object",
              "required": [
                "field",
                "value"
              ],
              "additionalProperties": false,
              "properties": {
                "field": {
                  "type": "string"
                },
                "value": {
                  "$ref": "#/definitions/datetime"
                }
              }
            },
            {
              "type": "object",
              "required": [
                "field",
                "otherField"
              ],
              "additionalProperties": true,
              "properties": {
                "field": {
                  "type": "string"
                },
                "otherField": {
                  "$ref": "#/definitions/string"
                },
                "offset": {
                  "$ref": "#/definitions/integer"
                },
                "offsetUnit": {
                  "type": "string"
                }
              }
            }
          ]
        }
      }
    },
    "afterOrAtConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "afterOrAt"
      ],
      "properties": {
        "afterOrAt": {
          "anyOf": [
            {
              "type": "object",
              "required": [
                "field",
                "value"
              ],
              "additionalProperties": false,
              "properties": {
                "field": {
                  "type": "string"
                },
                "value": {
                  "$ref": "#/definitions/datetime"
                }
              }
            },
            {
              "type": "object",
              "required": [
                "field",
                "otherField"
              ],
              "additionalProperties": true,
              "properties": {
                "field": {
                  "type": "string"
                },
                "otherField": {
                  "$ref": "#/definitions/string"
                },
                "offset": {
                  "$ref": "#/definitions/integer"
                },
                "offsetUnit": {
                  "type": "string"
                }
              }
            }
          ]
        }
      }
    },
    "beforeConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "before"
      ],
      "properties": {
        "before": {
          "anyOf": [
            {
              "type": "object",
              "required": [
                "field",
                "value"
              ],
              "additionalProperties": false,
              "properties": {
                "field": {
                  "type": "string"
                },
                "value": {
                  "$ref": "#/definitions/datetime"
                }
              }
            },
            {
              "type": "object",
              "required": [
                "field",
                "otherField"
              ],
              "additionalProperties": true,
              "properties": {
                "field": {
                  "type": "string"
                },
                "otherField": {
                  "$ref": "#/definitions/string"
                },
                "offset": {
                  "$ref": "#/definitions/integer"
                },
                "offsetUnit": {
                  "type": "string"
                }
              }
            }
          ]
        }
      }
    },
    "beforeOrAtConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "beforeOrAt"
      ],
      "properties": {
        "beforeOrAt": {
          "anyOf": [
            {
              "type": "object",
              "required": [
                "field",
                "value"
              ],
              "additionalProperties": false,
              "properties": {
                "field": {
                  "type": "string"
                },
                "value": {
                  "$ref": "#/definitions/datetime"
                }
              }
            },
            {
              "type": "object",
              "required": [
                "field",
                "otherField"
              ],
              "additionalProperties": true,
              "properties": {
                "field": {
                  "type": "string"
                },
                "otherField": {
                  "$ref": "#/definitions/string"
                },
                "offset": {
                  "$ref": "#/definitions/integer"
                },
                "offsetUnit": {
                  "type": "string"
                }
              }
            }
          ]
        }
      }
    },
    "notConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "not"
      ],
      "properties": {
        "not": {
          "$ref": "#/definitions/constraint"
        }
      }
    },
    "anyOfConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "anyOf"
      ],
      "properties": {
        "anyOf": {
          "type": "array",
          "minItems": 2,
          "items": {
            "$ref": "#/definitions/constraint"
          }
        }
      }
    },
    "allOfConstraint": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "allOf"
      ],
      "properties": {
        "allOf": {
          "type": "array",
          "minItems": 2,
          "items": {
            "$ref": "#/definitions/constraint"
          }
        }
      }
    },
    "conditionalConstraint": {
      "type": "object",
      "required": [
        "condition"
      ],
      "properties": {
        "condition": {
          "type": "object",
          "required": [
            "if",
            "then"
          ],
          "additionalProperties": false,
          "properties": {
            "if": {
              "$ref": "#/definitions/constraint"
            },
            "then": {
              "$ref": "#/definitions/constraint"
            },
            "else": {
              "$ref": "#/definitions/constraint"
            }
          }
        }
      }
    },
    "nullConstraint": {
      "type": "object",
      "required": [
        "null"
      ],
      "additionalProperties": false,
      "properties": {
        "null": {
          "type": "string",
          "required": [
            "field"
          ],
          "properties": {
            "field": {
              "type": "string"
            }
          }
        }
      }
    },
    "fromFileConstraint": {
      "type": "object",
      "required": [
        "inSet"
      ],
      "additionalProperties": false,
      "properties": {
        "inSet": {
          "type": "object",
          "required": [
            "field",
            "file"
          ],
          "additionalProperties": false,
          "properties": {
            "field": {
              "type": "string"
            },
            "is": {
              "const": "inSet"
            },
            "file": {
              "type": "string"
            }
          }
        }
      }
    },
    "inSetConstraint": {
      "type": "object",
      "required": [
        "inSet"
      ],
      "additionalProperties": false,
      "properties": {
        "inSet": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "field",
            "values"
          ],
          "properties": {
            "field": {
              "type": "string"
            },
            "values": {
              "type": "array",
              "items": {
                "oneOf": [
                  {
                    "$ref": "#/definitions/datetime"
                  },
                  {
                    "$ref": "#/definitions/numeric"
                  },
                  {
                    "$ref": "#/definitions/string"
                  }
                ]
              }
            }
          }
        }
      }
    },
    "inMapConstraint": {
      "type": "object",
      "required": [
        "field",
        "is",
        "file",
        "key"
      ],
      "additionalProperties": false,
      "properties": {
        "field": {
          "type": "string"
        },
        "is": {
          "const": "inMap"
        },
        "file": {
          "type": "string"
        },
        "key": {
          "type": "string"
        }
      }
    }
  }
}
